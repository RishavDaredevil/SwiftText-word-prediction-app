library(shiny)
library(rsconnect)
library(tidyverse)
library(DT)
library(shinythemes)


source("helper.r")
# Define UI with conditional Panel
ui <- fluidPage(theme = shinytheme(theme = 'cerulean'),
                titlePanel("Predictive Text Model App"),
                sidebarLayout(
                    sidebarPanel(width = 5,
                                 textInput(inputId = 'uploaded_data',label = 'Type Your word'
                                 ),
                                 fluidRow(column(6,actionButton("reset", "Reset & Reupload")),
                                          column(1,actionButton("action", "Predict"),offset = 4) 
                                 ),
                                 ),
                    mainPanel(width = 7,
                              tabsetPanel(
                                  tabPanel(title = 'Output',
                                           br(),
                                           DT::dataTableOutput('contents'),),
                                  tabPanel(title = 'Instructions',
                                           br(),
                                           br(),
                                           p("Welcome to the Predictive Text Model Shiny App! This documentation will guide you on how to use the app effectively to build and evaluate predictive text models, helping you predict the next word in a given text."),
                                           h4('1. Uploading Your Data'),
                                           HTML("When you open the app, you'll be greeted with a clean and user-friendly interface. Start by typing your text in the 'Type Your Word' input field."),
                                           h4('2. Predicting the Next Word'),
                                           HTML("Click the 'Predict' button to generate predictions for the next word based on the input text. The app will analyze your text and provide a list of potential next words."),
                                           h4('3. Reset and Reupload'),
                                           HTML("If you wish to clear the input and start fresh, you can click the 'Reset & Reupload' button to reset the input field."),
                                           h4('4. Viewing Predictions'),
                                           HTML("The predictions will be displayed in the 'Output' tab as a table. You can explore the predicted words generated by the model."),
                                           h3('Tips and Best Practices'),
                                           HTML(paste0("If you need to replace specific values in a column, you can use the substitution function. Here's how:",br(),
                                                         "<b>1. Cleaning Text</b>: Make sure to enter clean and well-structured text for the best results. The quality of your input text directly impacts the accuracy of predictions.",br(),
                                                         "<b>2. Efficiency</b>: Keep in mind that the app is designed for efficiency. It should provide quick predictions even on devices with limited memory and processing power.",br(),
                                                         "<b>3. Model Parameters</b>: The model uses n-grams to predict the next word, and the size of n can affect the accuracy of predictions. Here due to space and speed restrictions a model with n = 4 {n-gram model} has been implemented together with a backoff algorithm"))
                                  )
                              ))
                )
)
# Define server logic that generates a random number based on user input
server <- function(input, output,session) {
    edit <- reactiveValues(df_data = NULL)
    # observeEvent(input$uploaded_data,{
    #     edit$df_data <- predicting(input$uploaded_data)
    # })
    #orignal dataset
    observeEvent(input$action ,{
        df_data <- tibble(Predictions = predicting(as.character(input$uploaded_data)))
        edit$df_data <- df_data
        # edit$df_data <- tibble(Predictions = predicting(as.character(input$uploaded_data)))
    })
    observeEvent(input$reset, {
        session$reload()
    })
    

    output$contents <- DT::renderDataTable(edit$df_data)
    # output$download <- downloadHandler(
    #     filename = function() {
    #         paste("data-", Sys.Date(), ".csv", sep="")
    #     },
    #     content = function(file) {
    #         write.csv(edit$df_data, file)
    #     }
    # )
}

shinyApp(ui = ui, server = server)